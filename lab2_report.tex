\documentclass[12pt,a4paper]{article}

\usepackage[utf8]{inputenc}
\usepackage[margin=1in,headheight=20pt]{geometry}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{hyperref}
\usepackage{booktabs}
\usepackage{xcolor}
\usepackage{colortbl}
\usepackage{tcolorbox}
\usepackage{enumitem}
\usepackage{fancyhdr}
\usepackage{titlesec}
\usepackage{float}
\usepackage{array}

% Color definitions
\definecolor{primarycolor}{RGB}{0,102,204}
\definecolor{secondarycolor}{RGB}{51,51,51}
\definecolor{highlightcolor}{RGB}{255,235,59}
\definecolor{keycolor}{RGB}{0,150,136}
\definecolor{notecolor}{RGB}{255,152,0}

% Hyperlink colors
\hypersetup{
    colorlinks=true,
    linkcolor=primarycolor,
    citecolor=primarycolor,
    urlcolor=primarycolor
}

% Section formatting
\titleformat{\section}
  {\Large\bfseries\color{primarycolor}}{\thesection}{1em}{}[\titlerule]
\titleformat{\subsection}
  {\large\bfseries\color{secondarycolor}}{\thesubsection}{1em}{}

% Header and footer
\pagestyle{fancy}
\fancyhf{}
\fancyhead[L]{\textcolor{primarycolor}{Lab 2 - Car-Sharing System Model}}
\fancyhead[R]{\textcolor{secondarycolor}{\thepage}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\headrule}{\hbox to\headwidth{\color{primarycolor}\leaders\hrule height \headrulewidth\hfill}}

% Custom boxes
\newtcolorbox{keybox}{
  colback=keycolor!10,
  colframe=keycolor,
  boxrule=1pt,
  arc=3pt,
  left=5pt,
  right=5pt,
  top=5pt,
  bottom=5pt
}

\newtcolorbox{notebox}{
  colback=notecolor!10,
  colframe=notecolor,
  boxrule=1pt,
  arc=3pt,
  left=5pt,
  right=5pt,
  top=5pt,
  bottom=5pt,
  title={\textbf{Important Note}}
}

\newtcolorbox{summarybox}{
  colback=primarycolor!5,
  colframe=primarycolor,
  boxrule=1.5pt,
  arc=3pt,
  left=8pt,
  right=8pt,
  top=8pt,
  bottom=8pt
}


\title{
    \vspace{-1cm}
    {\Huge\textbf{\textcolor{primarycolor}{Computer Aided Simulation Lab}}} \\[0.5cm]
    {\LARGE Simulation of a Car Sharing System} \\[0.3cm]
    {\Large Labs 2 and 3}
}

\author{Riccardo Bracciale \\ S338616}
\date{}

\begin{document}

\maketitle
\thispagestyle{empty}

\begin{summarybox}
\begin{center}\textbf{Lab 2 Assignment:}\end{center}



The purpose of this lab is to develop a simulation model that captures the dynamics of a car-sharing system. 


In this system:
\begin{itemize}[leftmargin=*, label=\textcolor{primarycolor}{$\bullet$}]
\item{Users appear at various random locations and, using a smartphone app, identify and reserve an available car nearby.}
\item{After reserving, users can drive the car to their destination and leave it either in designated parking spots (e.g. rechargeable stations) or any available space.}
\item{Cars may be partially relocated to better align with demand when necessary.}
\end{itemize}
\end{summarybox}

\vspace{1cm}

\section*{Introduction}

The purpose of this laboratory is to develop a simulation model that captures the operational dynamics of a \textbf{car-sharing system} as described above. 


The following sections identify the fundamental system parameters, define the main performance indicators, outline the conceptual model design, and describe the data structures required to support the simulation.

\newpage

\section{Model Design}

\begin{keybox}
\textbf{Key Design Principle:} The simulation model is based on \textbf{discrete-event simulation} principles, where the system evolves through a sequence of discrete events rather than continuous time steps.
\end{keybox}

\vspace{0.5cm}

The whole system is represented as a collection of \textbf{entities} (users, vehicles, charging stations) that interact over time through a series of \textbf{events} (user arrivals, vehicle reservations, trip completions, charging operations, and relocations).

\subsection{Entities}

The main entities of the car-sharing system are as follows:

\begin{itemize}[leftmargin=*, label=\textcolor{primarycolor}{$\bullet$}]

    \item \textbf{User}: contains information such as current location, desired destination, reservation status, and time of arrival.

    \item \textbf{Vehicle}: stores attributes including current position, battery level, state (available, in use, charging, or reserved), and time since last relocation.

    \item \textbf{Car Relocator}: a special worker responsible for relocating low-battery vehicles to charging stations.


\end{itemize}



\subsection{Entities Behavior}

Users are expected to sign up for the platform: in the simulation, they can be created all instantly at the beginning of the simulation or arrive over time according to a stochastic process.

Once registered, users will randomly make requests to rent a car (following a stochastic process), with random destinations inside the service area.

All the entities interact according to the following processes:

\vspace{0.75cm}
\noindent\textbf{Reservation Process:}
\begin{enumerate}[leftmargin=*, label=\textcolor{primarycolor}{\arabic*.}]
    \item User makes a car request at a random location
    \item System searches for available cars within a search radius
    \item User is assigned to the \textit{closest available car}, if no cars are available, user retries (up to a maximum number of attempts)
    \item After exhausting attempts, user abandons the request
\end{enumerate}
\vspace{0.5cm}
\textbf{Rental Process:}
\begin{enumerate}[leftmargin=*, label=\textcolor{primarycolor}{\arabic*.}]
    \item After a successful reservation, the user will get to the car's location after a certain walking time, which depends on the distance between the user's initial position and the car's position.
    \item Then the user drives the car to the desired destination, the time taken will depend on the \textbf{traffic conditions} between the two points, which can change over time.
    \item During the trip, the car uses up energy based on the distance driven.
    \item If a car's battery is below a certain level at the end of a rental, it will be taken to be charged by a special worker called a \textit{relocator}. This person will pick up the car and drive it to the nearest charging station.
\end{enumerate}


\noindent These processes are implemented through the events described in the following section.



\subsection{Events}
The simulation operates through a series of discrete events that represent key moments in the system's operation:

\begin{itemize}[leftmargin=*, label=\textcolor{primarycolor}{$\bullet$}]

    \item \textbf{User Subscription Event}: A new user joins the car-sharing platform and becomes eligible to make reservations. This event triggers the scheduling of the user's first reservation attempt.

    \item \textbf{Reservation Event}: A user attempts to find and reserve an available car near their current location. The system searches for the nearest car within an acceptable walking distance. If successful, the user proceeds to pick up the car; if no car is available, the user may retry after some time.

    \item \textbf{Pickup Event}: A user walks to the reserved car's location and begins using it. This marks the start of a trip and records the walking time from reservation to pickup.

    \item \textbf{Dropoff Event}: A user completes their trip and leaves the car at the destination. The system updates the car's location and battery charge based on the distance traveled. If the battery is low, the car is marked for relocation to a charging station.

    \item \textbf{Relocate Car Event}: A car with low battery is assigned to a relocator (a worker who drives cars to charging stations). The system finds an available relocator and the nearest charging station, then schedules the car's arrival at the station.

    \item \textbf{Arrive at Station with Relocator Event}: A relocator delivers a car to a charging station. The car enters the charging queue or begins charging immediately if a spot is available.

    \item \textbf{Charging Complete Event}: A car finishes charging and its battery is fully restored. The car becomes available again for user reservations.


\end{itemize}

These events form a continuous cycle: users subscribe, make reservations, use cars, and return them, while the system manages car relocation and charging to maintain service availability.


\section{Data Structures}

\begin{notebox}
For a matter of simplicity, the service area is modeled as a flat 100 km Ã— 100 km square without geographical obstacles. Realistic traffic patterns are simulated through predefined traffic zones that affect vehicle speeds and travel times. The map structure and the relative graph representations and traffic condition can be considered parameters of the simulation model.
\end{notebox}

\vspace{0.5cm}


\subsection{Service Area and Traffic Zones}

The car-sharing service operates within a certain urban area divided into multiple traffic zones. Each zone has distinct traffic characteristics that affect vehicle travel times and user experience.
An example of a map used for most of our simulations is the following:

\begin{figure}[H]
\centering
\includegraphics[width=\textwidth]{traffic_zones_map.pdf}
\caption{\textbf{Traffic zones in the service area} - The map shows five distinct zones with different traffic patterns. The traffic factor, when present, indicates how much slower vehicles move compared to free-flow conditions, while the rush hour multiplier shows additional slowdown during peak hours.}
\label{fig:traffic_zones}
\end{figure}


These traffic patterns are incorporated into the road network simulation to provide realistic travel time estimates throughout the day.

\subsection{Road Network Graph}

To calculate realistic distances and travel times, the simulation uses a \textbf{graph structure} to represent the city's road network. This graph consists of:

\begin{itemize}[leftmargin=*, label=\textcolor{primarycolor}{$\bullet$}]
    \item \textbf{Nodes} (intersections): Points where roads meet, placed on a grid across the city
    \item \textbf{Edges} (roads): Connections between nodes that vehicles can travel along
\end{itemize}

\begin{notebox}
\textbf{}  
While, in this simulation, users can park anywhere in the service area, it is assumed that the time taken will be computed as the time needed to travel along the edges from the nearest node to the user's location to the nearest node to the destination location. This allows us to simulate realistic travel times based on actual road layouts and traffic conditions, rather than straight-line distances. 
\end{notebox}

\begin{figure}[H]
\centering
\includegraphics[width=0.95\textwidth]{road_network_graph.pdf}
\caption{\textbf{Road network graph and route calculation} - Left: The graph structure with nodes (intersections) and edges (roads). The blue path shows the route calculated by Dijkstra's algorithm. Right: Comparison between unrealistic straight-line distance and realistic graph-based distance following actual roads.}
\label{fig:road_network}
\end{figure}

\vspace{0.3cm}
\begin{enumerate}[leftmargin=*, label=\textcolor{primarycolor}{\arabic*.}]
    \item When a user needs to travel from point A to point B, the system finds the nearest graph node to each point
    \item Each edge (road) is weighted by \textbf{travel time}.
    \item Dijkstra's algorithm finds the path with the \textbf{minimum total travel time}
    \item Roads in high-traffic zones get higher time weights, so the algorithm prefers faster alternative routes
\end{enumerate}

This approach means cars automatically avoid congested areas when faster routes exist, just like real drivers with GPS navigation.


\section{Key Parameters}
The simulation of such a complex system has a huge variety of parameters, however in this experimentation, we will focus on this subset of key parameters:

\begin{itemize}[leftmargin=*, label=\textcolor{primarycolor}{$\bullet$}]
    \item \textbf{Fleet Size}: amount of cars available in the system
    \item \textbf{Maximum Pickup Radius}: maximum distance a user is willing to walk to reach a car
    \item \textbf{Maximum amount of users}: limit on the total number of users in the system
    \item \textbf{User Subscription Rate}: rate at which new users join the platform, if set to a very high value, all users sign in at the beginning of the simulation
    \item \textbf{User Reservation Rate}: rate at which each user makes car rental requests
    \item \textbf{Number of charging stations}: total number of charging stations available in the service area
    \item \textbf{Number of relocators}: total number of relocators responsible for moving cars between locations
\end{itemize}

\section{Performance Indicators}
To evaluate the performance of the car-sharing system, we will track the following key performance indicators (KPIs):

\begin{itemize}[leftmargin=*, label=\textcolor{primarycolor}{$\bullet$}]
    \item \textbf{Fleet Utilization}: the percentage of the fleet in use at any given time, a car sharing company may want it to be both high enough to ensure profitability but not too high to avoid user dissatisfaction due to unavailability
    \item \textbf{Successful Reservations Rate}: the ratio of successful car reservations to total reservation attempts, it should be as high as possible
    \item \textbf{Average Walking Distance}: the average distance users walk to reach their reserved cars
    \item \textbf{Average Attempts per Reservation}: the average number of attempts users make before successfully finding an available car, should be as close as possible to 1

\end{itemize}

\section{Implementation}

\begin{summarybox}
    \begin{center}\textbf{Lab 2 Assignment:}\end{center}
    The goal of this lab is to implement in Python  the simulator of the model developed in LAB 2.   You should also test your simulator, in a few scenarios and assess the impact of some input parameters (the choice of the subset of parameters to test is left to you) on the dynamics.
\end{summarybox}

As shown in the course this discrete-event simulation is implemented using a \textbf{Future Event Set (FES)}, which determines when and how things happen in the simulation.


\subsection{The Future Event Set (FES)}

The FES is a \textbf{priority queue} that stores all scheduled events sorted by time. 

\begin{keybox}
\textbf{How the FES works:}
\begin{enumerate}[leftmargin=*]
    \item Events are added to the FES with a specific time when they should occur
    \item The FES automatically keeps events sorted by time (earliest first)
    \item The simulator repeatedly takes the next event from the FES and processes it
    \item Processing an event may create new events, which are added back to the FES
\end{enumerate}
\end{keybox}

\noindent\textbf{Example:} When a user subscribes at time 100, the simulator schedules a "reservation event" at time 120. When that reservation succeeds, it schedules a "pickup event" at time 125, which then schedules a "dropoff event" at time 180. If the dropoff causes the car to need charging, a "relocate car event" is scheduled at time 185, and so on.

\subsection{Main Simulation Loop}

The simulator follows a simple pattern:

\begin{enumerate}[leftmargin=*, label=\textcolor{primarycolor}{\arabic*.}]
    \item \textbf{Initialize}: Create all entities (cars, stations, relocators, road network)
    \item \textbf{Schedule initial events}: Add first user arrival to FES
    \item \textbf{Main loop}: Repeat until simulation end time:
    \begin{itemize}[label=\textcolor{keycolor}{$\circ$}]
        \item Get the next event from FES (the one with earliest time)
        \item Check if event time exceeds simulation end time - if yes, stop
        \item Execute the event (call its associated function)
        \item The event function updates system state and schedules new events
    \end{itemize}
    \item \textbf{Finish}: Collect and report final metrics
\end{enumerate}




\subsection{Project Structure}

The python code is organized into logical modules that separate different concerns, following best practices of the object oriented programming paradigm: 

\begin{itemize}[leftmargin=*, label=\textcolor{primarycolor}{$\bullet$}]
    \item \textbf{Entities/}: Classes representing active participants in the system (class definitions only)
    \begin{itemize}[label=\textcolor{keycolor}{$\circ$}]
        \item \texttt{Car.py} - \texttt{Car} class: manages vehicle location, battery level, and status, implementing the corresponding entity.
        \item \texttt{user.py} - \texttt{User} class: handles user initialization and attributes, implementing the corresponding entity.
        \item \texttt{car\_relocator.py} - \texttt{CarRelocator} class: manages relocator availability and task assignment, implementing the correspoinding entity.
    \end{itemize}
    
    \item \textbf{infrastructure/}: Classes for physical infrastructure (class definitions only)
    \begin{itemize}[label=\textcolor{keycolor}{$\circ$}]
        \item \texttt{road\_map.py} - functions to build the road map graph and calculate routes and travel time
        \item \texttt{charging\_station.py} - handles all interactions related to charging stations 
    \end{itemize}
    
    \item \textbf{Core simulation files}:
    \begin{itemize}[label=\textcolor{keycolor}{$\circ$}]
        \item \texttt{simulator.py} - Runs the simulation, implements the FES loop and coordinates all events
        \item \texttt{events.py} - Here all the event functions are defined.
        \item \texttt{config.py} - Configuration parameters and constants supports the loading of parameters from YAML files. 
        \item \texttt{metrics.py} - \texttt{Metrics} utilities to collects statistics and performs transient analysis
    \end{itemize}
\end{itemize}

\vspace{0.3cm}
\noindent
\subsection{Running instructions}






\newpage

\section{Experimental Scenarios and Results}

To evaluate the car-sharing system under different operating conditions, we designed several experimental scenarios focusing on the impact of fleet size and user demand. All experiments were conducted with a 2-week simulation period (20,160 minutes) to allow the system to reach steady-state operation and provide statistically significant results.

\subsection{Experimental Design}

\subsubsection{User Arrival Pattern}

All scenarios use an \textbf{instant arrival pattern} where all users subscribe to the service at the simulation start. This approach:

\begin{itemize}[leftmargin=*, label=\textcolor{primarycolor}{$\bullet$}]
    \item Simulates a mature car-sharing service with an established user base
    \item Eliminates the transient phase of gradual user adoption
    \item Provides immediate system stress testing
    \item Allows direct comparison of steady-state performance across scenarios
\end{itemize}

After arrival, users make reservation requests at a rate of 0.02 requests per hour (approximately one request every 50 hours per user), representing realistic usage patterns for occasional car-sharing service users.

\subsubsection{Test Scenarios}

Four scenarios were designed to systematically evaluate the system:

\begin{table}[H]
\centering
\renewcommand{\arraystretch}{1.4}
\begin{tabular}{@{}lcccc@{}}
\toprule
\rowcolor{primarycolor!20}
\textbf{Scenario} & \textbf{Users} & \textbf{Cars} & \textbf{Ratio} \\
\midrule
Baseline & 20 & 20 & 1:1 &\\ 
\rowcolor{gray!10}
500 Users, 50 Cars & 500 & 50 & 10:1  \\
2000 Users, 50 Cars & 2000 & 50 & 40:1 & \\
\rowcolor{gray!10}
5000 Users, 200 Cars & 5000 & 200 & 25:1 & \\
\bottomrule
\end{tabular}
\caption{Experimental scenarios testing different user-to-car ratios and system scales.}
\label{tab:scenarios}
\end{table}

All scenarios maintain consistent infrastructure:
\begin{itemize}[leftmargin=*, label=\textcolor{keycolor}{$\circ$}]
    \item 5 charging stations distributed across the service area
    \item 3 relocators for car redistribution
    \item Maximum pickup distance: 3 km 
\end{itemize}

\subsection{Performance Results}

\subsubsection{Comprehensive Metrics Table}
The following table presents all key performance indicators across the four experimental scenarios:

\begin{table}[H]
\centering
\small
\renewcommand{\arraystretch}{1.3}
\begin{tabular}{@{}lcccc@{}}
\toprule
\rowcolor{primarycolor!20}
\textbf{Metric} & \textbf{Baseline} & \textbf{500u/50c} & \textbf{2000u/50c} & \textbf{5000u/200c} \\
\midrule
\multicolumn{5}{l}{\textit{\textbf{Service Quality Indicators}}} \\
\rowcolor{gray!10}
Success Rate & 83.0\% & 91.5\% & 80.8\% & 81.2\% \\
Total Reservations & 459 & 3,314 & 13,190 & 13,054 \\
\rowcolor{gray!10}
Avg Attempts & 1.00 & 1.01 & 1.05 & 1.05 \\
Total Trips & 379 & 3,029 & 10,643 & 10,578 \\
\midrule
\multicolumn{5}{l}{\textit{\textbf{Fleet Performance Indicators}}} \\
\rowcolor{gray!10}
In-Use Rate & 0.1\% & 11.5\% & 41.4\% & 42.3\% \\
Charging Rate & 0.1\% & 5.1\% & 19.6\% & 19.3\% \\
\rowcolor{gray!10}
Idle Rate & 99.8\% & 83.4\% & 39.0\% & 38.4\% \\
\midrule
\multicolumn{5}{l}{\textit{\textbf{Operational Indicators}}} \\
\rowcolor{gray!10}
Avg Trip Distance & 6.3 km & 6.0 km & 6.1 km & 6.0 km \\
Total Distance & 2,390.9 km & 18,248.4 km & 64,436.1 km & 63,555.9 km \\
\rowcolor{gray!10}
Charging Sessions & 45 & 398 & 1,455 & 1,433 \\
Avg Queue Length & 0.50 & 1.05 & 2.36 & 2.27 \\
\bottomrule
\end{tabular}
\caption{Complete performance metrics for all experimental scenarios.}
\label{tab:complete_results}
\end{table}

\subsubsection{Key Findings}

Based on the data in Table \ref{tab:complete_results}, we can describe the scenarios based on user and car (c) counts.

\begin{itemize}
    \item The \textbf{Baseline} scenario shows a system with minimal activity, characterized by a 99.8\% Idle Rate. The specific user and car counts are not defined but activity is negligible.
    \item The \textbf{500u/50c} scenario introduces 500 users and 50 cars. This configuration results in the highest Success Rate (91.5\%) but a relatively low fleet utilization (11.5\% In-Use Rate).
    \item The \textbf{2000u/50c} scenario increases the user load to 2000 users while keeping the fleet at 50 cars. This high user-to-car ratio leads to a significant increase in fleet utilization (41.4\%) but also a drop in the Success Rate to 80.8\%.
    \item The \textbf{5000u/200c} scenario scales up both users (5000) and cars (200). Interestingly, despite the four-fold increase in cars compared to the previous scenario, key metrics like the Success Rate (81.2\%) and In-Use Rate (42.3\%) remain remarkably similar to the 2000u/50c case.
\end{itemize}

\section{Conclusion}

The experimental results presented in this report illustrate the complex dynamics between fleet size, user demand, and service performance. The data indicates that increasing the scale of the system, as seen when transitioning from the 2000u/50c to the 5000u/200c scenario, does not necessarily lead to proportional or intuitive changes in key performance indicators.

The similarity in performance between the last two scenarios, despite significantly different resource allocations, suggests that system behavior is governed by non-linear factors. These preliminary findings raise questions about operational bottlenecks and resource efficiency. Further investigation is required to fully understand the observed dynamics and to determine effective strategies for balancing service quality with fleet utilization.

\end{document}


\section{Conclusion}

\end{document}